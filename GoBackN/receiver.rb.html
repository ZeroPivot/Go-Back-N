<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>receiver.rb</title>
<meta name="Generator" content="SciTE - www.Scintilla.org" />
<style type="text/css">
.S0 {
	color: #808080;
}
.S2 {
	font-family: 'Comic Sans MS';
	color: #007F00;
	font-size: 9pt;
}
.S4 {
	color: #007F7F;
}
.S5 {
	font-weight: bold;
	color: #00007F;
}
.S6 {
	font-family: 'Courier New';
	color: #7F007F;
	font-size: 10pt;
}
.S8 {
	font-weight: bold;
	color: #0000FF;
}
.S9 {
	font-weight: bold;
	color: #007F7F;
}
.S10 {
	font-weight: bold;
	color: #000000;
}
.S12 {
	color: #000000;
	background: #A0FFA0;
	text-decoration: inherit;
}
.S14 {
	color: #C0A030;
}
.S16 {
	color: #B00080;
}
.S29 {
	font-weight: bold;
	color: #00007F;
}
span {
	font-family: 'Verdana';
	color: #000000;
	font-size: 10pt;
}
</style>
</head>
<body bgcolor="#FFFFFF">
<span><span class="S5">class</span><span class="S0"> </span><span class="S8">Receiver</span><br />
require<span class="S0"> </span><span class="S6">"LinkedList.rb"</span><span class="S0"> </span><span class="S2"># !YAY?</span><br />
LENGTH<span class="S10">=</span><span class="S4">50</span><span class="S10">,</span>MAX_BOUND<span class="S10">=</span><span class="S4">99999</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">initialize</span><span class="S10">(</span>length<span class="S10">,</span>offset<span class="S10">=</span><span class="S4">0</span><span class="S10">)</span><span class="S0"> </span><span class="S2"># :seq contains the sequence#; :data contains the packet data; :have is for tracking purposes only...</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span>raise<span class="S0"> </span><span class="S6">"length cannot be 0"</span><span class="S0"> </span><span class="S29">if</span><span class="S0"> </span>length<span class="S10">==</span><span class="S4">0</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@debug</span><span class="S10">=</span><span class="S5">false</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@receiving</span><span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S5">false</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@offset</span><span class="S10">=</span>offset<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@list</span><span class="S10">=</span>LinkedList<span class="S10">.</span>new<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@length</span><span class="S10">=</span>length<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@length</span><span class="S10">.</span>times<span class="S0"> </span><span class="S10">{</span><span class="S0"> </span><span class="S10">|</span>i<span class="S10">|</span><span class="S0"> </span><span class="S16">@list</span><span class="S10">.</span>insertBack<span class="S10">(</span><span class="S0"> </span><span class="S10">{</span><span class="S14">:seq</span><span class="S10">=&gt;</span><span class="S16">@offset</span><span class="S10">+</span>i<span class="S10">+</span><span class="S4">1</span><span class="S10">,</span><span class="S14">:data</span><span class="S10">=&gt;</span><span class="S5">nil</span><span class="S10">,</span><span class="S14">:have</span><span class="S10">=&gt;</span><span class="S5">false</span><span class="S10">}</span><span class="S0"> </span><span class="S10">)</span><span class="S0"> </span><span class="S10">}</span><span class="S0"> </span><span class="S2">#no more off-by-1 errors, muahahahaha (creating the linked list of n length) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span>setRange<span class="S10">(</span><span class="S16">@offset</span><span class="S10">..</span><span class="S16">@list</span><span class="S10">.</span>getLastNode<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">])</span><span class="S0"> </span><span class="S2">#ranges makes out of bound packets trivial.</span><br />
<span class="S0">&nbsp;  &nbsp;</span><span class="S16">@location</span><span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S16">@list</span><span class="S10">.</span>getFirstNode<span class="S0"> </span><span class="S2">#current position in the buffer</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">padder</span><span class="S10">(</span>seqnum<span class="S10">,</span>syn_max_len<span class="S10">=</span><span class="S4">5</span><span class="S10">);</span>seqnum<span class="S10">.</span>to_s<span class="S10">.</span>length<span class="S10">&lt;=</span>syn_max_len<span class="S0"> </span><span class="S10">?</span><span class="S0"> </span><span class="S10">(</span><span class="S6">"0"</span><span class="S10">*(</span>syn_max_len<span class="S10">-</span>seqnum<span class="S10">.</span>to_s<span class="S10">.</span>length<span class="S10">)</span><span class="S0"> </span><span class="S10">+</span><span class="S0"> </span>seqnum<span class="S10">.</span>to_s<span class="S10">)</span><span class="S0"> </span><span class="S14">:</span><span class="S0"> </span><span class="S10">(</span>seqnum<span class="S10">.</span>to_s<span class="S10">);</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">range</span><span class="S10">;</span><span class="S16">@range</span><span class="S10">;</span><span class="S5">end</span><span class="S0"> </span><span class="S2">#can find out of a frame is within the buffer or not by range.member? frame# &nbsp;</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">setRange</span><span class="S10">(</span>range<span class="S10">);</span><span class="S16">@range</span><span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S10">(</span>range<span class="S10">);</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">list</span><span class="S10">;</span><span class="S16">@list</span><span class="S10">;</span><span class="S5">end</span><span class="S0"> </span><span class="S2">#returns the actual data structure, for debugging purposes only one would hope.</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">minSEQ?</span><span class="S10">;</span><span class="S16">@list</span><span class="S10">.</span>getFirstNode<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">];</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">maxSEQ?</span><span class="S10">;</span><span class="S16">@list</span><span class="S10">.</span>getLastNode<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">];</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">debug</span><span class="S10">(</span>string<span class="S10">);</span>puts<span class="S0"> </span>string<span class="S0"> </span><span class="S29">if</span><span class="S0"> </span><span class="S16">@debug</span><span class="S10">;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">nak</span><span class="S10">(</span>loc<span class="S10">=</span><span class="S5">nil</span><span class="S10">);</span>loc<span class="S10">==</span><span class="S5">nil</span><span class="S0"> </span><span class="S10">?</span><span class="S0"> </span><span class="S10">(</span>puts<span class="S0"> </span><span class="S6">"NAK </span><span class="S10">#{</span>padder<span class="S10">(</span><span class="S16">@location</span><span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">])}</span><span class="S6">"</span><span class="S10">)</span><span class="S0"> </span><span class="S14">:</span><span class="S0"> </span><span class="S10">(</span>puts<span class="S0"> </span><span class="S6">"NAK </span><span class="S10">#{</span>padder<span class="S10">(</span>loc<span class="S10">)}</span><span class="S6">"</span><span class="S10">);</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">ack</span><span class="S10">(</span>val<span class="S10">=</span><span class="S5">nil</span><span class="S10">);</span>val<span class="S10">==</span><span class="S5">nil</span><span class="S0"> </span><span class="S10">?</span><span class="S0"> </span><span class="S10">(</span>puts<span class="S0"> </span><span class="S6">"ACK </span><span class="S10">#{</span>padder<span class="S10">(</span><span class="S16">@location</span><span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">])}</span><span class="S6">"</span><span class="S10">)</span><span class="S0"> </span><span class="S14">:</span><span class="S0"> </span><span class="S10">(</span>puts<span class="S0"> </span><span class="S6">"ACK </span><span class="S10">#{</span>padder<span class="S10">(</span>val<span class="S10">)}</span><span class="S6">"</span><span class="S10">);</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">multi</span><span class="S10">;</span><span class="S5">yield</span><span class="S10">;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">full?</span><span class="S10">;</span><span class="S16">@list</span><span class="S10">.</span>traverse<span class="S10">{|</span>node<span class="S10">|</span><span class="S0"> </span><span class="S5">return</span><span class="S0"> </span><span class="S5">false</span><span class="S0"> </span><span class="S29">if</span><span class="S0"> </span><span class="S10">!</span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:have</span><span class="S10">]};</span><span class="S5">true</span><span class="S10">;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">noHas</span><span class="S10">;</span><span class="S16">@list</span><span class="S10">.</span>traverse<span class="S10">{|</span>node<span class="S10">|</span><span class="S0"> </span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:have</span><span class="S10">]=</span><span class="S5">false</span><span class="S10">};</span><span class="S5">end</span><span class="S0"> </span><span class="S2">#cheezburger... resets every node to false--for data structure purposes</span><br />
<br />
<span class="S5">def</span><span class="S0"> </span><span class="S9">changeOffset</span><span class="S10">(</span>offset<span class="S10">)</span><span class="S0"> </span><span class="S2">#used to sync the offset with the sender, or to reset it to 0</span><br />
<span class="S0">&nbsp;  &nbsp;</span><span class="S16">@list</span><span class="S10">.</span>traverse<span class="S0"> </span><span class="S5">do</span><span class="S0"> </span><span class="S10">|</span>node<span class="S10">|</span><br />
<span class="S0">&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;</span>debug<span class="S10">(</span><span class="S6">"before: </span><span class="S10">#{</span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]}</span><span class="S6">"</span><span class="S10">)</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]</span><span class="S0"> </span><span class="S10">-=</span><span class="S0"> </span><span class="S16">@offset</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]</span><span class="S0"> </span><span class="S10">+=</span><span class="S0"> </span>offset<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug<span class="S10">(</span><span class="S6">"after: </span><span class="S10">#{</span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]}</span><span class="S6">"</span><span class="S10">)</span><span class="S0">&nbsp;</span><br />
<span class="S0">&nbsp;  &nbsp;&nbsp;&nbsp;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@offset</span><span class="S0"> </span><span class="S10">=</span><span class="S0"> </span>offset<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setRange<span class="S10">(</span><span class="S16">@offset</span><span class="S10">..</span><span class="S16">@list</span><span class="S10">.</span>getLastNode<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">])</span><br />
<span class="S0">&nbsp;</span><span class="S5">end</span><br />
<br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">nakCheck</span><span class="S0"> &nbsp;</span><span class="S2">#true if nak exists; this was also implemented when I didn't fully understand go-back-n...</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S16">@list</span><span class="S10">.</span>traverse<span class="S0"> </span><span class="S5">do</span><span class="S0"> </span><span class="S10">|</span>node<span class="S10">|</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span><span class="S5">false</span><span class="S0"> </span><span class="S29">if</span><span class="S0"> </span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]</span><span class="S0"> </span><span class="S10">&gt;</span><span class="S0"> </span><span class="S16">@location</span><span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; </span><span class="S5">if</span><span class="S0"> </span><span class="S10">!</span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:have</span><span class="S10">]</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>nak<span class="S10">(</span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">])</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span><span class="S5">true</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; </span><span class="S5">end</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">end</span><br />
<span class="S0">&nbsp;  &nbsp;</span><span class="S5">return</span><span class="S0"> </span><span class="S5">false</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">end</span><br />
<br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">changeLocation</span><span class="S10">(</span>frame<span class="S10">)</span><span class="S0"> </span><span class="S2">#I implemented this back when I didn't fully understand go-back-n; this program was actually more complex before...</span><br />
<span class="S0">&nbsp; </span><span class="S16">@list</span><span class="S10">.</span>traverse<span class="S0"> </span><span class="S5">do</span><span class="S0"> </span><span class="S10">|</span>node<span class="S10">|</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">if</span><span class="S0"> </span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]==</span>frame<br />
<span class="S0">&nbsp; &nbsp; &nbsp; </span><span class="S16">@location</span><span class="S10">=</span>node<br />
<span class="S0">&nbsp; &nbsp; &nbsp; </span><span class="S5">break</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">end</span><br />
<span class="S0">&nbsp; </span><span class="S5">end</span><br />
<span class="S0">&nbsp;  &nbsp;</span><span class="S16">@location</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">end</span><span class="S0">&nbsp;</span><br />
<span class="S0">&nbsp;&nbsp;</span><br />
<span class="S0">&nbsp; </span><span class="S2">#### Here's where it gets interesting; the event function is what makes this move. ###</span><br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">def</span><span class="S0"> </span><span class="S9">event</span><span class="S10">(</span>string<span class="S10">)</span><span class="S0"> </span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span>packet<span class="S10">=</span>string<span class="S10">.</span>split<span class="S10">(</span><span class="S12">/ /</span><span class="S10">,</span><span class="S4">3</span><span class="S10">)</span><span class="S0"> &nbsp;</span><span class="S2"># Since the data is unimportant compared to the first two words, this splits the packet into a 3-length array</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span>command<span class="S10">=</span>packet<span class="S10">[</span><span class="S4">0</span><span class="S10">]</span><span class="S0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S2"># Contains the sender's command &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="S0">&nbsp;  &nbsp;</span>frame<span class="S10">=</span><span class="S0"> </span>packet<span class="S10">[</span><span class="S4">1</span><span class="S10">].</span>to_i<span class="S0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S2"># The frame</span><br />
<span class="S0">&nbsp;  &nbsp;</span>data<span class="S10">=</span>packet<span class="S10">[</span><span class="S4">2</span><span class="S10">]</span><span class="S0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S2"># The sender's data</span><br />
<span class="S0">&nbsp;  &nbsp;</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">case</span><span class="S0"> </span>command<span class="S0"> </span><span class="S2">#every packet the sender sends takes place here </span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">when</span><span class="S0"> </span><span class="S6">"SYN"</span><span class="S0"> </span><span class="S2">#start receiving data</span><br />
<span class="S0">&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug<span class="S10">(</span><span class="S6">"made it this far"</span><span class="S10">)</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">if</span><span class="S0"> </span><span class="S10">!</span><span class="S16">@receiving</span><span class="S0"> </span><span class="S2">#do nothing if we're already receiving, otherwise, magic &nbsp;&nbsp;</span><br />
<span class="S0">&nbsp; &nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>changeOffset<span class="S10">(</span>frame<span class="S10">)</span><br />
<span class="S0">&nbsp; &nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ack<span class="S10">(</span>frame<span class="S10">+</span><span class="S4">1</span><span class="S10">)</span><br />
<span class="S0">&nbsp; &nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@receiving</span><span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S5">true</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">when</span><span class="S0"> </span><span class="S6">"DAT"</span><span class="S0"> </span><span class="S2">#search for appropriate location of buffer, check to see if in range, check to see if data length is EXACTLY 50</span><br />
<span class="S0">&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">if</span><span class="S0"> </span><span class="S16">@receiving</span><span class="S0"> </span><span class="S5">and</span><span class="S0"> </span>range<span class="S10">.</span>member?<span class="S0"> </span>frame<span class="S0"> </span><span class="S2">#this frame is within the buffer if true</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">if</span><span class="S0"> </span>full?<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug<span class="S10">(</span><span class="S6">"full before"</span><span class="S10">)</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>noHas<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@location</span><span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S16">@list</span><span class="S10">.</span>getFirstNode<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">if</span><span class="S0"> </span>frame<span class="S0"> </span><span class="S10">==</span><span class="S0"> </span><span class="S16">@location</span><span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">if</span><span class="S0"> </span>frame<span class="S10">==</span>MAX_BOUND<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>changeOffset<span class="S10">(-</span><span class="S4">1</span><span class="S10">)</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@location</span><span class="S10">.</span>object<span class="S10">[</span><span class="S14">:data</span><span class="S10">]=</span>data<span class="S10">;</span><span class="S0"> </span><span class="S16">@location</span><span class="S10">.</span>object<span class="S10">[</span><span class="S14">:have</span><span class="S10">]=</span><span class="S5">true</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">if</span><span class="S0"> </span><span class="S16">@location</span><span class="S10">.</span>next<span class="S0"> </span><span class="S10">==</span><span class="S0"> </span><span class="S16">@list</span><span class="S10">.</span>rightSentinelNode<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>noHas<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>changeOffset<span class="S10">(</span>frame<span class="S10">)</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@location</span><span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S16">@list</span><span class="S10">.</span>getFirstNode<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ack<span class="S0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">else</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S16">@location</span><span class="S10">=</span><span class="S16">@location</span><span class="S10">.</span>next<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ack<br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">end</span><span class="S0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">elsif</span><span class="S0"> </span>frame<span class="S0"> </span><span class="S10">&gt;</span><span class="S0"> &nbsp;</span><span class="S16">@location</span><span class="S10">.</span>object<span class="S10">[</span><span class="S14">:seq</span><span class="S10">]</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nak<span class="S0"> </span><span class="S2">#nak the current location...</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">end</span><br />
<span class="S0">&nbsp; &nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">end</span><br />
<span class="S0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="S5">when</span><span class="S0"> </span><span class="S6">"FIN"</span><span class="S0"> </span><span class="S14">:</span><span class="S0"> &nbsp;</span><span class="S16">@list</span><span class="S10">.</span>traverse<span class="S10">{|</span>node<span class="S10">|</span><span class="S0"> </span>puts<span class="S0"> </span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:data</span><span class="S10">]</span><span class="S0"> </span><span class="S29">if</span><span class="S0"> </span>node<span class="S0"> </span><span class="S10">!=</span><span class="S0"> </span><span class="S16">@list</span><span class="S10">.</span>rightSentinelNode<span class="S0"> </span><span class="S5">and</span><span class="S0"> </span>node<span class="S0"> </span><span class="S10">!=</span><span class="S0"> </span><span class="S16">@list</span><span class="S10">.</span>leftSentinelNode<span class="S0"> </span><span class="S5">and</span><span class="S0"> </span>node<span class="S10">.</span>object<span class="S10">[</span><span class="S14">:data</span><span class="S10">]</span><span class="S0"> </span><span class="S10">!=</span><span class="S0"> </span><span class="S5">nil</span><span class="S10">};</span>exit<br />
<span class="S0">&nbsp;&nbsp;</span><span class="S5">end</span><span class="S0"> &nbsp;&nbsp;</span><br />
<span class="S5">end</span><br />
<span class="S5">end</span></span>
</body>
</html>
